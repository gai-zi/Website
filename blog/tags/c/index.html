<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/Website/blog/rss.xml" title="Gaizi HomePage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Website/blog/atom.xml" title="Gaizi HomePage Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">One post tagged with &quot;C++&quot; | Gaizi HomePage</title><meta data-react-helmet="true" property="og:title" content="One post tagged with &quot;C++&quot; | Gaizi HomePage"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://gai-zi.github.io/Website/blog/tags/c"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="icon" href="/Website/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://gai-zi.github.io/Website/blog/tags/c"><link data-react-helmet="true" rel="alternate" href="https://gai-zi.github.io/Website/blog/tags/c" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://gai-zi.github.io/Website/blog/tags/c" hreflang="x-default"><link rel="stylesheet" href="/Website/assets/css/styles.d9d837ef.css">
<link rel="preload" href="/Website/assets/js/runtime~main.82b6447d.js" as="script">
<link rel="preload" href="/Website/assets/js/main.c450cb58.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Website/"><div class="navbar__logo"><img src="/Website/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/Website/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Gaizi</b></a><a class="navbar__item navbar__link" href="/Website/docs/intro">Documents</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Website/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gai-zi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/Website/blog/ShooterGame说明文档">ShooterGame说明文档</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/Website/blog/搭建Docusaurus教程">搭建Docusaurus教程</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/Website/blog/welcome">Welcome</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;C++&quot;</h1><a href="/Website/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_d4p0" itemprop="headline"><a itemprop="url" href="/Website/blog/ShooterGame说明文档">ShooterGame说明文档</a></h2><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-01-18T10:10:41.944Z" itemprop="datePublished">January 18, 2022</time> · <!-- -->49 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/gai-zi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://avatars.githubusercontent.com/u/57099417?v=4" alt="Gai Zi"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gai-zi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Gai Zi</span></a></div><small class="avatar__subtitle" itemprop="description">Games Builder</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>此项目为&quot;2021腾讯游戏高校公开课&quot;大作品项目说明文档</p><p>项目源代码：<a href="https://github.com/gai-zi/ShooterGame" target="_blank" rel="noopener noreferrer">gai-zi/ShooterGame: Aurora Studios (github.com)</a></p><p>打包游戏链接：<a href="https://share.weiyun.com/Lxd5HSw1" target="_blank" rel="noopener noreferrer">https://share.weiyun.com/Lxd5HSw1</a></p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>UE版本：4.26</p><p>“如需要进入编辑器或导出应用查看实现效果，请选择&#x27;Highrise&#x27;地图”</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="游戏模式">游戏模式<a class="hash-link" href="#游戏模式" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="炮台使用说明">炮台<strong>使用说明</strong><a class="hash-link" href="#炮台使用说明" title="Direct link to heading">​</a></h3><p> 1、玩家贴近炮台，准星对准炮台，按<strong>E键</strong>进入炮台，再按E键退出炮台继续操控原角色</p><p>2、<strong>旋转鼠标X轴</strong>，能够旋转炮台朝向方向</p><p>3、鼠标左键，发射<code>BP_Missile</code>导弹，遇到障碍物或玩家能够爆炸，产生范围伤害</p><p>4、使用炮台发射的导弹击杀玩家，能够获得双倍积分</p><p><img src="/Website/assets/images/炮台E-091a3bee25efab680f4253d9655ef815.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目一">题目一<a class="hash-link" href="#题目一" title="Direct link to heading">​</a></h3><p>在场景中生成一个炮台</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果">实现效果<a class="hash-link" href="#实现效果" title="Direct link to heading">​</a></h4><p>创建&quot;BP_Turret&quot;蓝图继承自定义cpp类<code>ATurret</code>，置于场景中</p><p><img src="/Website/assets/images/场景中炮台-f85321cb43516f3c89c86a5d74959da6.png"></p><p><img src="/Website/assets/images/炮台-3b81953b6abb221ec2a51a6458b28b19.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法">解决办法<a class="hash-link" href="#解决办法" title="Direct link to heading">​</a></h4><p>新建<strong>cpp类 ATurret</strong> 继承自 APawn</p><p>头文件声明必要的组件和属性，构造函数定义组件的属性</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SHOOTERGAME_API</span><span class="token plain"> ATurret </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> APawn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">protected</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">EditAnywhere</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Category</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UBoxComponent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> BoxComponent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//最下层底座</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">EditAnywhere</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Category</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UStaticMeshComponent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> Base</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//可转底座</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">EditAnywhere</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Category</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UStaticMeshComponent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> Base2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//发射器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">EditAnywhere</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Category</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UStaticMeshComponent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> Launcher</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//相机组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">EditAnywhere</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Category</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Component</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UCameraComponent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> OurCamera</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//要生成的发射物蓝图</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TSubclassOf</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">AShooterProjectile</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ProjectileClass</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>BP_Turret蓝图继承此cpp类，将炮台的各个mesh、material赋值，填充新的组件，组件列表如下</p><p><img src="/Website/assets/images/炮台组件列表-54f064ff2dbeef26042781995c323f72.png"></p><ul><li>Box Component：盒体碰撞体<ul><li>Base：炮台底部基座<ul><li>Base1：炮台支架，通过旋转此组件实现发射器左右旋转<ul><li>Launcher：发射器，从发射器内发射BP_Missile导弹</li><li>Our Camera：摄像机组件</li></ul></li></ul></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目二">题目二<a class="hash-link" href="#题目二" title="Direct link to heading">​</a></h3><p>炮台可以按照固定频率向固定方向发射炮弹</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-1">实现效果<a class="hash-link" href="#实现效果-1" title="Direct link to heading">​</a></h4><p>进入炮台后，按鼠标左键能够发射导弹，<strong>间隔时间 1.5s</strong> ；</p><p><img src="/Website/assets/images/炮台发射-d9e2a9e35bec5d2e6ffd6a1663af63b4.png"></p><p><img src="/Website/assets/images/炮台发射物爆炸-c7572d1a39ac74e8b6c6ead056edfc13.png"></p><p>自定义导弹状发射物<strong>BP_Missile</strong>蓝图，继承自 <code>AShooter Projectile</code>，导弹发射和运动能够实现多人同步</p><p><img src="/Website/assets/images/导弹蓝图组件-a863939bd0cc3894ce104e4716c7d5e6.png"></p><p><img src="/Website/assets/images/第三方视角发射导弹-95b13e13a9441d7d6adbea88f3e24952.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-1">解决办法<a class="hash-link" href="#解决办法-1" title="Direct link to heading">​</a></h4><h4 class="anchor anchorWithStickyNavbar_y2LR" id="导弹">导弹<a class="hash-link" href="#导弹" title="Direct link to heading">​</a></h4><p>自定义蓝图 BP_Missile 继承自 Shooter Projectile </p><p>从网络资源中找到导弹的mesh，新建Static Mesh组件并添加成为BP_Missile的mesh</p><p><img src="/Website/assets/images/Missile_Mesh-d4bd182c58671894b4e990ae8002b724.png"></p><p>定义Explpsion Template为ProjRocket_Explosion，添加爆炸粒子效果，当击中物体时产生爆炸</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAmsAAABfCAYAAAC3OIB2AAAaz0lEQVR4nO2dCbRV0x/Hd/NEyStKFA0aKEUDUpnTYCiRRLHI3BKZp6IiY4aiTImiJDKFZcpQxsiQokSzKZSieu/1/j6/tfb7n2733XffHd497/l+1rrrvXvuufvss88evvv3++19yzRs2DBv9913d55y5crZq2zZsq5MmTJOCCGEEEIUP0uWLHGTJk1y5SM/2LRpk8vOzna5ubkuLy8vE3kTolSxdu1al5WVlelsCCGEKGFs3LjR5eTkuLLBg4g0CTUhhBBCiPCwnViTUBNCCCGECA/buEExtQkhhBBCiPBQtvBThBBCCCFEppBYE0IIIYQIMRJrQgghhBAhRmJNCCGEECLESKwJIYQQQoQYiTUhhBBCiBAjsSaEEEIIEWK2+7mp4qZp06butNNOc3vttZdtxjt06FD3yy+/FHhcCCGEEOK/RNrE2kMPPeR23nnnqJ+tXr3aDR482NWsWdNdd911rmrVqu6ff/5xv/32m/vggw9cq1atoh7nB+crVaqUriwLIYQQQoSOtFvW/vjjDxNbQZYvX+4WLlzoBg0aZIIMjjnmGBNx5cuXd61bt456nFcqOPvss123bt3cihUr3JAhQ1KSphBCCCFEOkhY/bRv397+fvzxxzHPe/rpp91dd921ndDCQlajRg37f+vWrW7lypWuefPmdnynnXaKejzVbNq0yS1atMg1a9Ys5WkLIYQQQqSChMRay5YtTaytWbOmULEGuEN32223bY6NHj3aNWnSxP4vW7as+/777938+fNdtWrVoh4fMWKEHcPShlWsTp06buPGjXb9SZMmmbsUypQp444//nh3xBFHuNq1a5tl76OPPnLTpk2zc4LuWa6zYMECd88997h3333XRGK/fv1cmzZt3I477uh+/vln98Ybb7hZs2aZcBRCCCGEKG6KJNYQT7vuuqs76qij3B577GFirTCqV69usWa77LJL/rGffvrJXsSs1apVy44tXrzYXKMIpmjHEW3EsfXp08eOc23OIS9Y3bDelStXzlycCDpAbGVlZbljjz3W8nDjjTeapY7zsOpt2bLFLVu2zH399ddu3bp1lkaDBg1cdna2fZd7PPPMM+06EydONCEohBBCCFGcFGnrjipVqlicWb169eL+Dpaq6dOnu3HjxuW/cnJy3N13320WMcBqhcAaOXKkGzZsWNTjWOZ69eplx++88053yCGHuIEDB9r7zp07m5u1bt26rmvXrnaM7xx88MHu9NNPt/dYyzgHwfbqq6/aMYQaVrq5c+e6Ro0amVCDvn37ukMPPdSNHTvW3nMOcXNCCCGEEMVN3JY1xFLv3r3NUoaFLV6wZC1dunSbY9988425UiNXi/rYsWjHEWdYxODXX391J554olng2NYDixcCsnHjxvnWr6lTp9oxrGf33XefW7t2rVnjsKhxDx6scqRP/NrmzZvtPVuGIODmzJnjZsyYYVY20qEMZF0TQgghRHESl1irX7++69ixo1mfisrLL79sVrTgAgHi0opKUGAR7xbtcyx/8Pfff1t8Gi5QmD17tq1IRex5wRfJhg0b3KhRo9yAAQNMlPJCvBETN3nyZNvjTUJNCCGEEMVNoWKNWLO2bdvmr/5MBOLQIhcYFBUWE3hOOeWU7TbIxXKG0AJEG1t/eAsg8WoITr6DBa0gWGxwwQUXuAoVKrh27dpZep06dXINGzZ05513nqtYsWJS9yCEEEIIUVRi+jOJ8erSpYsJlkyD69SvyOzevbtZ6hBkBP+TPxYDsAjBu0Vxk3I+IpHVnmPGjLFzc3NzzaUJrPj0gu7oo4821+njjz9u6X7yySduwoQJ9hnuVBYgkLYQQgghRHES07KGK5BfE0iGk08+2VZsYq3yEHOGy7Eo8J2ZM2danrB4sT0HosvHt/Xv399iy1g8wIKA4cOHW4yad4XOmzfPXLJs1+Fj6Nj+47333nPjx4+37T1YWMAxtgkhLeLqgNWiLDDAQhi8DyGEEEKIdBNTrLFlRqxVkPFs3cEiAF6RRC46iIcpU6bY94477jj7zVCEE0IKEcdebHvvvbd79NFH7ZwePXqYRQzX5yuvvGKLDLCY4SJl4QDfZ8Un79mLjV9VuOyyy1zPnj1dhw4d7HPi3Niyg1WhlStXTtkvKAghhBBCxEuZhg0b5hHTBevXr09p4sSAsWdZNIj/atGihVnMVq1aZcf4mSlPQccBEcWLBQC4PBFSfm823uOuRKT9/vvvZn1D1GEVY484v8CAc0gfoYa7FDcqVjrOR4Sy4IAtRvguK0j5rsSaSATiKb2FVwghhIgX9qQlRCutYk0IIbEmhBAiMbxYK9KmuEIIIYQQoniRWBNCCCGECDESa0IIIYQQIUZiTQghhBAixEisCSGEEEKEGIk1IYQQQogQI7EmhBBCCBFiJNaEEEIIIUKMxJoQQgghRIiRWBNCCCGECDHb/Nhl9erVM5UPIUotGzduVNsSQghRZPj9cn7TXJY1IYQQQogQI7EmhBBCCBFiJNaEEEIIIUKMxJoQQgghRIgpX/gpQohUk52d7f7++2+3efNml5ubm+nsiBJK2bJlXaVKlVzVqlVdxYoVM50dIUSakFgTIgMg1A455BDXrl07t9tuu7kyZcpkOkuihJGXl+d+/vlnN2/ePPfmm29KrAlRipFYEyIDYFFr27at69Spk9txxx1t4BWiKCDw2RYGEGtCiNKLxJoQGQDXZ506dcx9tWHDBok1UWQQa1WqVHG77LKL7cMkhCi9SKwJkSEQbLy2bt2a6ayIEggCn/qTk5OT6awIIdKMxJoQGYLB1r+ESIRU1h1vqWvfvr1bt26dW7hwodu0aVPK0o9G+fLl3Q477OD23HNPt8cee7hdd93VVahQwf3+++9u7dq1bvHixRaXl458cN0BAwa45s2bW/offvihmzFjRsqvI0QqkFgTIoNIrIlkSFX9YVUpP4l21FFHuaZNm7rPPvvMffPNNynIYcGwIKJu3bquTZs2rnbt2raq1btzec+Lz7/99lv33XffuT///DOl1+daLO6pXLmy5SUrKyul6QepWbOm23fffd1ee+1lQvT9999369evN6u6L3sWHO28887uhx9+cF9//bX9zJAQnhK5z9ojjzziWrRokVQaDz30kM2oShOpKBdRfAQta+l6YSV544030pY+A8/ee+9tA2px3E+qXs2aNXNz5sxJKg0G37lz52b8XpIF0YJFq2PHjrboBQGDxSvd7lVi7fbZZx/XsGFDs+r9+OOPJhI//vhj9+WXX5plrVatWnZOkyZNTMylEq5ZrVo1u1fEGlbFdMB19ttvPytfVn8feOCBJswoc67LX95znM85j/OTWSF+zuA817FLdgrvQmSatFvW7rvvPmsQwU7liy++cPfee2+6Lx2TQYMGpSytq666yjoTYJYEPg7ptddec08//XTKrpUKmMmST5b8i8zhB9tgzNpBBx1kM27gGbEIoU+fPu7cc89N6BoffPCB/eUawbQZJJjlDx482B122GEJ34PPe+R9xMPbb79tggBrTiyC+fYceuihbty4cUXLbASJ5DkI/RhkMuYwWcFGHcOChTjo3LmziaMtW7aYgKPfDt4b/7M/IK9kwZpVv359q4O4IBcsWGDWM8Q/cXi4Qhs0aGDiEesaE4KVK1e6NWvWJH3tTIAgxc3LgiJeXbp0sfJctWqVq1evnr3Hqsbz4Dxcv++8805C10KodTiosmvabKvbp9WWbT5bs8q5zz/d6lYu14KUkkaxuEHvv/9+9+mnnxbHpTLC6NGj8/9HuC1atMjNnDkzgzmKTevWra0zlFjLPNEG2zvvvNN17drVjuMOOe+881yNGjVc3759t/tuUWffPm0G5BdeeMFdfPHFbtasWTZgJJr/gu6jMNhugi1MjjzyyLjzHe3aiZIqy1QmSVaosW0MkzfEApYuQKgxScBKHxRmPCtccwiJZK1uiEIseFyLOk5fFIxL47pLliwxaxoTC9yEiLdkxBoxalzPtxnS9JNroE/caaed8t8jpmgnycbL8Yx++eUXKztEKtfk/o844ghLm2MINX9NBCvnJ/psF3yZY0KtXLmcf+9127zvt39VV7mKcxMnbLDyECWHjMWsMWM655xz3JVXXmmV+PTTTzfr1I033miV6NZbb3VTp051PXv2NDP166+/7l5++eXt0mFWSJBoo0aNLKbhxRdfzLcm4KY45ZRT7BxmZU888YSZ2gGXIQMAcRkFpcEAeffdd9sMnnQwk3N88uTJRb5fGucZZ5xh1/j111/dlClTzHXkr/Hoo4+6Xr162TUYPAnupXyY3b711lsW+Mq58ZYLszPKlA6Oe+L7uBcuuugid8ABB9g5iLYLLrigwLyJ9EJnHG01Hx22P4arvlu3buayY0A9/PDD7ZlhraX+MtBSt0eOHGmWHgZc6k2PHj3s+1jNrrjiCksjmDYDxgknnOBuv/12s2rgiomVzrJly9yIESPsXAZy2i1uG59P/vK655573EsvvWT5I04Hy8FNN91kbi0EIZMZ2v6ll16avzfY7NmzzZ0Yi2CZeHDvXn311Vb/ye+oUaPc/PnzrX3Qp9BGhg4d6h5++GEb/Pv37+/OOuus/O/7so9135Q75cw59E/XXnttfqgB7Wf8+PFWDgWl8dtvv9kzu+uuu6ys2aaF49dcc01+Ph544IG46sv555+/3bFkVhPTzx599NFu//33tz7Ag2jh3iJDKigrAv4pb+pDMlBGiKW//vrLRFlB4o9ypS+j7IN5TAT6eAQifSrQBoKCBevdsGHD8t/jhsUtS3+cLMSoIRJpwz42DmEYOeFCqH300UdW7xJlzjsV/q0XG13Vapvc2DErzZLnuWZ4Hde0eSW7jsRayaJYxBqNMtjQ6EixtOHe6N27tzUGTPB0tv6nd5hRYf6+/vrrTURgAaCDYBbmYZZEp08HiaDC1DxkyBDrIBFluHgQVgisY4891oTKZZddtk3eYqXB7AYaN25sjZjZD/lh4OEVL1zjkksuse/g/j344IMtL5dffnn+OdwrHTgDGQMK+UG4MjBy/PPPP7fOI55yAQZ0Gj3ijjgIBg8E4NixY92ZZ55pHfKDDz4YM2/pXgn2X4cBChGBxcJD5x15jAGLZ84sH/755x/3/PPPm8WBX0JgECfmBQsv9YDn6V1bpMd1SC8ybQKZSZM6HysdYoaw7uGuRLggrviMQdtbXvjLpOLxxx93EyZMsAGCDVuph8TgIFRo57Q1LHq33HKLiRuuj5gL3m8k5JtJhJ9oAYM9GwrThyAQGYifffZZm4Rxv6TLPX3//ffuySefNJFJnmnLiCuf51j3jVDmfy92SZv35N9TWBq77767nYfliEnQTz/9ZO2PfNPWgPPJHwNoNOh3eAbRyoh2TJ+ZiBUGMYsgQzxE7tNG3Yr8RQSuwapN+momvslA2lyTPobyK0hw8hwpYyamyS4A4HlixSKtaERa1qjDfgxIFtz4jHk8KyxqXCdo1eP+mVQTGkBfH+n2Lyofvl/x3zazziyniF3Psh+yXcvWzq6FG1qUHIpFrDGTZHbpueOOO6yyIKTosKlMzLKDnTEwKDAw0Zkxw+nQocM2ooSOlwZMJ02jxkr2ySefWGdCWnTaCEUaJ9ayaLOVWGk888wzdg6xAww8vBg4mZ0VRawxK+Q7jz32mIkvBkksaNy37wzee+8967jII505y8i5HoMNHTwNC7EWT7kAYo6Ogc4Jt6wPImYmG2/emEWL9MHzoc55EeZ599133erVq21w5NktXbrUJhn+PB/jxXs6dlxDCHyeMQINaxr12S+g8eIFWFhDvab+YNHAQkb9ZyApKB0GU+rpwIEDbYChLeMKoy75AQfLGHUIoc9qQp832iFih2tR17AsIUxatWplA5Qvg8LA8jxt2rT891ijmQAysTrttNMs3unEE0+0CUywTBEkCAMskLTpV155xSxJgAiIdd9MWOg7uHfyzXUo+2B+C0sDkQv0gUy0sHQjjskvEzNA4NEP0s9Q1kEQDLTv6667Lmo5cSzR35ZlICd9REo8YAHifC9AkwHhSb30W3cwHkQTbDw78sdnkWVTVPg+aRUk1iLh2cZTN+OB/NN/Y2mmn48U17znOJ9zXiriIGnXJd3NL/5PsYi1p556KmrMGhY2RAkdG26CWCBYEFZBqIzMQIINCosY59HQ6ATprG+77Ta3YsUKiyOLnCnFSiMadDDxdm7Ba/C94447Lv8YVq5oDclbP4L54X9EVzSilQsQ38MMjobvO/No8U1FyZtILT5gO9Ky5lenIYRwU3nR4C0v1Af/HTp3bw3wx7DoIIi8NS1oWcM1jmjhGO5K2h1CJlY6CEfvsvGfYREH9uMCXI8MhggLfw4TG8QLQsvDtaiP/gfsKYNYVjVfJljoyHcQvsdkjHqOtevmm2/OT8u3n2BZMSnx5QKUPaKzoPvmuohCLGInnXSSiSzCBfjcU1ga0fJBmSCWg/eNqEO0TJ8+fZt7ROQhEgsqIwRgopa1r776yq7pfwg+HhAU3G+yUJcRwEwgmRjSTzE5DYoUygkLKu50yo86mgx4WEjPr/qkH8f16ftzxgEmRh7qNpOlVEBbpq8lFIC+PLIv5j3H+ZwxijJOVrAFLXei5JPRfdaYGeMOwHp0/PHHxzSt0xnSuIPQ4OmsaWzeHUOaHKfzobETD8JfVo8x6OE2pKOMJ41U4dPCXRMZm0EcWjJEKxcGFawMxNcw4+f+idspat5EemGQjRRr0LJlS3OpBc8LWqCCAz/PH6sEVi7vtkJcMTBEc30G/8e1hyscl3usdPxn1DM/sGFZZpLg6wwu+4kTJ1ooA5MkBgovYLDyRk5wvFjzwq0wopUTMKgRt8lWHFz/wgsvzC+jyLLClYo4CZZFrPtGQCBAsQyST9y+WDiZfHpxU1ga0fLh4++C98P3mGAhykkf+vXrZ1ZMPiuojLh+opY1rKGIBPoHrJ5Bi1M0iy/XWb58uXkBkoWyRRxhCeXZIVDoq3zf7OPJ+AyBxcQe8Z8MkYu+eG6Et/h6ilCjH0wHjDFYUv2qT6Ae+Jg17pfjGC74nxi3ZPeVq5m12bXYd1vB1qRpRbdmlX4xpSSSUenNLJWgd4J0iWvBfRKEY8w26EjYL4rg4SC46Wj0zPKZHdKwaRBUdBoHgwTuFhoEnS6NInIGGiuNVME16Gz8NegcsJgkuo9OYeVC50tHwItZJFs/BGF2zEBCoG2q8ybixz8jL1q8hSTyWPDlv+ffU1+x4kyaNMksE9QF6i7Wpsjzo6XNM2eAjJUOn2HdIPaLc3HVM8gFXXCky0SIARUrG8dpz0x8fJqIJVyDCBU+p24ySDMoFXS/hZUJgyuxawgqFhwgPINlhZBDZBImgJuR+M1gnmPdNxMZ3Kz0UZzrtyDyC0PiSSPaMwOfRvBFGAKD9amnnmovJpjEKsYqGz/gJwoeD9zuTJg9CEDuAYsirm3/Imbvueees1CJZMHKiThBICLGEKrEEuK6ZxJAv33MMceY5Yv+ivyV1G07gMkXVmfakYd6z2QjKMooE86jj0+W6jWca3dgedez1/9f1WtsdQsXbNkuHlGEn2KxrOHCCHYoCAQ6fCxABCMzI3311VctVuuGG27IP4/ZOK4NGjTBy7hMg9BZjRkzxmJpcFdQ6ekw/UpGrEnMThEmDAosIIgMmo+VRrJWLw+DE9fAncE1eM+9JPrjy4WVC/FBzH6HDx9uM3JilPhLjAowkLAilAGXQa6gvMnSln6iDbYFbSkRbZsMZuE8R7bHwcVJZ491iYD0aOdHpo3bhbrOYFJQOoDljPaDdQJRwUQIy4cPhCZNJkgE1nMugy0ihjSZjJEm9RXLAmKAOozVCOsO3yGWLhZY64ITCALjEUPknRWftFVWt7JIhpe/RwQlLkbqcvfu3c2VGiyLWOUH5A3rI/0HwonVrAjceNPwu9BHewbRnjHXoM+KfOYFkaxYo18gTtengaWLNAmv4HjkPmt+1W8ysEqfl98uhnSxVFJfGBN472PZEGi4ImOtGA071FvvzqWu+O05WEzg91lDpPt91vjL+dGMC0Vh2dJK7qZr128XC45QC4pGUTIo82/jyEtFwGgq8dtZsAqyJM+mUo3KpWTCs2IQjjxG0DibgqbzZ2VYJclK4KBbNYywh1yk241JVkHu+8KgTLHcIzDD1r+lEgZdBmMWbQVXMhYVhDbikgUUCAW/JVA6BBITYx87htgn/1gkeY/HgImiX2WL2xVrLfFjqY6j5Z7ZMYCYOe4TKyMWxFTjt+wg5AeLIvfChJgVwnh1qOdMnrEs0sfjQudzFpIpdliw2wOLMfXboEJkiGi/YJAqGHywjmC1ZmDM5C778eDjtCJJNN9BK1bY7z0ZUjWYI5pYves3yfULqdIh1pi4IGAQLQg1RAseDb+7P2IN4U6eEHHpsqhxDa6Ne57/U7WYIBKeETGe1EMmZwi04G+D4gr1YTcIN//boBJqIojEmhAZJF0dMmEGLK4hFqiglc2lmaBYK82k8lcYCBHBokZcIlatdK0mRKQhBLEYEGPoFw5ELpRKN9wv4TfFAW5PYgN5ReL3WGN1thAFEUo3qBCliYLcoLiz2WQ0lSuPxX8L4ptwFbJZcTJuUCFEOJEbVIgQUBp+n1JkjliLFYQQpQeJNSEyAHE5rDBkZaXfd0mIokIgPpt4l+a4PCGExJoQGYHl8+xwDywAECIRCFanHmm3eiFKNxJrQmQANlhl41E2XE10B3ohEGns+0Z9EkKUXiTWhMgArIZTQLgQQoh4kO1cCCGEECLESKwJIYQQQoQYiTUhhBBCiBAjsSaEEEIIEWIk1oQQQgghQozEmhBCCCFEiJFYE0IIIYQIMRJrQgghhBAhRmJNCCGEECLESKwJIYQQQoQYiTUhhBBCiBAjsSaEEEIIEWIk1oQQQgghQozEmhBCCCFEiJFYE0IIIYQIMRJrQgghhBAhRmJNCCGEECLESKwJIYQQQoQYiTUh0kzdunUznQUhhBAlGIk1IYQQQogQI7EmhBBCCBFiykceyM7Otldubq7Ly8vLRJ6EKFWsXbvWZWVlZTobQgghShibN282PbaNZU1CTQghhBAiXGwn1iTUhBBCCCHCwzZu0JycnEzlQwghhBBCREELDIQQQgghQozEmhBCCCFEiPkf3Ys1RwoZppcAAAAASUVORK5CYII="></p><p>射线检测碰撞，发射一条从基坐标向运动方向的射线，如果触碰到就隐藏Mesh，再跟随根组件一起销毁，避免爆炸完后游戏世界还留有一个空壳炸弹的bug</p><p><img src="/Website/assets/images/Missile射线检测-baf358474a6794fefcd33a470fa705e9.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="炮台pawn控制发射">炮台Pawn控制发射<a class="hash-link" href="#炮台pawn控制发射" title="Direct link to heading">​</a></h4><p>Turret.h声明必要的属性和方法</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//控制发射间隔参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> bCanFire </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> LastFireTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> FireRate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.5f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//发射导弹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">UFUNCTION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Fire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>设置鼠标左键按键绑定，绑定Fire()函数</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">PlayerInputComponent</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">BindAction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Fire&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">IE_Pressed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ATurret</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">Fire</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>构造函数获取导弹蓝图BP_Missile</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> ConstructorHelpers</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">FClassFinder</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">AShooterProjectile</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ProjectileBP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Blueprint&#x27;/Game/Blueprints/Weapons/BP_Missile.BP_Missile_C&#x27;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ProjectileBP</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Succeeded</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ProjectileClass </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ProjectileBP</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Class</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Fire()函数内获取当前发射器旋转和坐标，来定义导弹出生位置的坐标和旋转；</p><p>如果条件允许，生成导弹</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">ATurret</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">Fire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">bCanFire</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">//获取炮台基座的世界坐标下的旋转</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token comment" style="color:#999988;font-style:italic">//为各个组件的坐标相加，不过多赘述</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   FRotator MissileWorldRotator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BaseWorldRotation </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> Base2WorldRotation</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   FVector MissileWorldLocation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> BoxWorldLocation </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> BaseWorldLocation </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> Base2WorldLocation </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> LuncherWorldLocation</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   UWorld</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> World </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetWorld</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">World</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      FActorSpawnParameters SpawnParams</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SpawnParams</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Owner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SpawnParams</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Instigator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetInstigator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ProjectileClass</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         AShooterProjectile</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> Proj</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> World</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">SpawnActor</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">AShooterProjectile</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ProjectileClass</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">MissileWorldLocation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">MissileWorldRotator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">SpawnParams</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   bCanFire </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   LastFireTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>每帧计算当前时间间隔，若超过 1.5s 未发射导弹，将bCanFire置为true，每次发射后在Fire()方法中都会将bCanFire重置为false，重新计时。</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">ATurret</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">Tick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> DeltaTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token class-name">Super</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">Tick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DeltaTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">bCanFire </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> LastFireTime </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.5f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      LastFireTime </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> DeltaTime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LastFireTime </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.5f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> bCanFire </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>实现发射物按固定间隔1.5s发射导弹</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目三">题目三<a class="hash-link" href="#题目三" title="Direct link to heading">​</a></h3><p>炮弹可以击中角色并产生一定伤害</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-2">实现效果<a class="hash-link" href="#实现效果-2" title="Direct link to heading">​</a></h4><p>导弹击中敌人产生爆炸效果，同时对敌人造成伤害，伤害值置为50，直接击败敌人</p><p><img src="/Website/assets/images/炮台击败敌人-377c65479b96c65ca9d31b77be57cc18.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-2">解决办法<a class="hash-link" href="#解决办法-2" title="Direct link to heading">​</a></h4><p>通过基类 ShooterProjectile 方法，在发生碰撞后调用Explode()方法产生爆炸效果，并且调用<code>ApplyRadialDamage</code>方法造成伤害</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token class-name">UGameplayStatics</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">ApplyRadialDamage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> WeaponConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExplosionDamage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NudgedImpactLocation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> WeaponConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExplosionRadius</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> WeaponConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DamageType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> TArray</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">AActor</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MyController</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目四">题目四<a class="hash-link" href="#题目四" title="Direct link to heading">​</a></h3><p>玩家可以让角色操控炮台调整左右方向，同时只能一个角色操控</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-3">实现效果<a class="hash-link" href="#实现效果-3" title="Direct link to heading">​</a></h4><p>能够让玩家操控炮台并左右方向旋转发射器，同时只能有一个角色进入炮台</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-3">解决办法<a class="hash-link" href="#解决办法-3" title="Direct link to heading">​</a></h4><h4 class="anchor anchorWithStickyNavbar_y2LR" id="角色控制炮台">角色控制炮台<a class="hash-link" href="#角色控制炮台" title="Direct link to heading">​</a></h4><p>ATurret类中定义<code>CurrentShooterCharacter</code>，用于存放当前控制自己的角色实例</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//当前控制此炮台的角色</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BlueprintReadWrite</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AShooterCharacter</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> CurrentShooterCharacter</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>PlayerPawn蓝图中定义：</p><ul><li>PlayerPawn：当前角色的<code>AShooterCharacter</code>实例</li><li>PlayerPawnController：当前角色的控制器</li></ul><p>按E键，角色从当前相机位置向前发射一条射线，如果碰撞到了Turret，则可以控制该炮台，并且把这个炮台的<code>CurrentShooterCharacter</code>赋值为自身</p><p><img src="/Website/assets/images/E键进入炮台-58deb5b2513c30a0a43a300c61667aaf.png"></p><p>Trace From Camera 方法中发射射线，并且检测是否碰撞的是炮台，将角色蓝图中的Turret赋值，并返回布尔值true</p><p><img src="/Website/assets/images/摄像机射线-611215d2a6bf0c22b1ff7ed7338dc3cb.png"></p><p>炮台中按E键会让控制器重新控制当前的人物角色<code>CurrentShooterCharacter</code></p><p><img src="/Website/assets/images/炮台重新操控人物-acbe075e5e941a13fe24a436dbe78a78.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现炮台转向">实现炮台转向<a class="hash-link" href="#实现炮台转向" title="Direct link to heading">​</a></h4><p>当前炮台拥有两个基座和一个发射器，需要调整左右方向，就需要更改 Base2 的Rotation Z值</p><p><img src="/Website/assets/images/旋转炮台-6ee78dbe433b58afc7aed45d1afc9f14.png"></p><p>在Turret.h中声明TurnRight()方法，将其与鼠标X轴映射绑定，方法代码如下</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">ATurret</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">TurnRight</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> Value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">//沿着Z轴旋转roll</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> Base2Yaw </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Base2</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetRelativeRotation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Yaw</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Value</span><span class="token operator" style="color:#393A34">!=</span><span class="token number" style="color:#36acaa">0.0f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Base2</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">SetRelativeRotation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">FRotator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.0f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Base2Yaw</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">Value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0.0f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>实现左右旋转炮台</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目五">题目五<a class="hash-link" href="#题目五" title="Direct link to heading">​</a></h3><p>玩家操控炮台击中敌方，导致死亡，玩家可以获得双倍积分</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-4">实现效果<a class="hash-link" href="#实现效果-4" title="Direct link to heading">​</a></h4><p>枪械击杀敌人得分：2分</p><p><img src="/Website/assets/images/枪械击杀敌人得分-88b6ff9eabaa187a3926d1a2b1808a79.png"></p><p>炮台击杀敌人得分：4分</p><p><img src="/Website/assets/images/炮台击杀敌人得分-ba7754c4c76b5258e5bbc4c5a7b95d5f.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-4">解决办法<a class="hash-link" href="#解决办法-4" title="Direct link to heading">​</a></h4><p>在<code>AShooterCharacter::Die(...)</code>方法中添加判断，根据Tag判断是否造成伤害的物体为Missile</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//增加积分并通知死亡事件发生</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DamageCauser</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">Tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">FName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Missile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>如果传入的参数判定为导弹击杀，则将击杀分数乘2</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">KillerPlayerState</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">ScoreKill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">VictimPlayerState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> KillScore </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>实现操控炮台击败敌方，当前玩家可以获得双倍积分</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="umg界面">UMG界面<a class="hash-link" href="#umg界面" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="界面操作">界面操作<a class="hash-link" href="#界面操作" title="Direct link to heading">​</a></h3><ul><li><p>按X键呼出3D UI，镜头指向按钮，鼠标右键能够点击3D按钮</p></li><li><p>P或Esc键呼出Option菜单</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目一-1">题目一<a class="hash-link" href="#题目一-1" title="Direct link to heading">​</a></h3><p>添加一个击杀时醒目UI(屏幕中上方，注意Anchor和Alignment)</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-5">实现效果<a class="hash-link" href="#实现效果-5" title="Direct link to heading">​</a></h4><p>在玩家击杀一个敌方单位后，屏幕中上方显示击杀图标</p><p><img src="/Website/assets/images/击杀图标-6a662974aecf02ecb27633ef45eb9d92.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-5">解决办法<a class="hash-link" href="#解决办法-5" title="Direct link to heading">​</a></h4><p>创建一个继承自UuserWidget的蓝图名为<code>BP_KillWidget</code>；</p><p>添加Image组件命名为<code>Kill_Image</code>；</p><p>设定锚点为<strong>正上方</strong>，并给Alignment的X、Y值都赋为<strong>0.5</strong>，保证其在锚点正上方中央位置</p><p><img src="/Website/assets/images/Kill_Image-f0a86007814fe53c0e6411917c97cb59.png"></p><p><img src="/Website/assets/images/Alignment-36c72f83483af3a30d8ce9144ac4340d.png"></p><p><img src="/Website/assets/images/Kill_Image编辑蓝图-8ac1ad40274aa0746959063679ecaaa0.png"></p><p>在<strong>ShooterHUD.h</strong>中声明蓝图类<code>KillWidgetClass</code></p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** 击杀后客户端显示的Widget*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TSubclassOf</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">UUserWidget</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> KillWidgetClass</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UUserWidget</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> KillWidget</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在<strong>ShooterHUD.cpp</strong>的构造函数中使用<code>ConstructorHelpers::FclassFinder</code>获取到蓝图BP_KillWidget</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token class-name">AShooterHUD</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">AShooterHUD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FObjectInitializer</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> ObjectInitializer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ObjectInitializer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//获取蓝图资源BP_KillWidget</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> ConstructorHelpers</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">FClassFinder</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">UUserWidget</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">KillWidgetCl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;WidgetBlueprint&#x27;/Game/Blueprints/UI/BP_KillWidget.BP_KillWidget_C&#x27;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">KillWidgetCl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Succeeded</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        KillWidgetClass </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> KillWidgetCl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Class</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在击败敌人后，会调用<code>AShooterHUD::DrawRecentlyKilledPlayer()</code>方法，在其中进行保护判断，如果存在<code>KillWidget</code>实例则remove，如果不存在就生成实例，将其添加进ViewPort．</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//创建KillWidget</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">KillWidget</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KillWidget</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">RemoveFromParent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KillWidget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nullptr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">KillWidgetClass </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">KillWidget</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">AShooterPlayerController</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> ShooterPC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Cast</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">AShooterPla yerController</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PlayerOwner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        KillWidget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CreateWidget</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">UUserWidget</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ShooterPC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">KillWidgetClass</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">KillWidget</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            KillWidget</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">AddToViewport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><hr><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目二-1">题目二<a class="hash-link" href="#题目二-1" title="Direct link to heading">​</a></h3><p>为击杀UI添加动画(Fadeln&amp;Out/缩放等均可)</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-6">实现效果<a class="hash-link" href="#实现效果-6" title="Direct link to heading">​</a></h4><p>题目一中创建的UI在生成后能够FadeOut的效果后消失</p><p><img src="/Website/assets/images/FadeOut效果图-ed36b9c1eed3f06cec36bbdd464a08c5.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-6">解决办法<a class="hash-link" href="#解决办法-6" title="Direct link to heading">​</a></h4><p>在<code>BP_KLillWidget</code>蓝图中为<code>Kill_Image</code>创建Animation，命为&quot;FadeOut_Animation&quot;，添加2个关键帧，定义图片的Alpha值</p><table><thead><tr><th>时间（s）</th><th>Item</th></tr></thead><tbody><tr><td>0.00</td><td>Color.A = 1.0</td></tr><tr><td>2.00</td><td>Color.A = 0.0</td></tr></tbody></table><p>在Event Graph中设定逻辑播放动画，实现FadeOut的效果</p><p><img src="/Website/assets/images/FadeOut-cba3f7a7b26dd2ce0b57faa7a3560a67.png"></p><hr><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目三-1">题目三<a class="hash-link" href="#题目三-1" title="Direct link to heading">​</a></h3><p>左上角显示游戏帧数，选项菜单里增加一个选项，作为控制是否显示游戏帧数的开关 </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-7">实现效果<a class="hash-link" href="#实现效果-7" title="Direct link to heading">​</a></h4><p>在Option选项中添加控制FPS显示的开关，开启后能够在屏幕左上角显示帧数；</p><p>选项的数据（包括FPS是否开启显示）会存储在磁盘；</p><p>不同客户端会根据自身选项进行显示与否．</p><p><img src="/Website/assets/images/FPS-390daa98b40538ac5197c50b8eb8598c.png"></p><p><img src="/Website/assets/images/FPS_Off-6d1f58fb149428514bbbace2fa177b06.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-7">解决办法<a class="hash-link" href="#解决办法-7" title="Direct link to heading">​</a></h4><p>在<strong>ShooterOptions.h</strong>中声明确定FPS开关的属性和方法</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** FPS显示选项*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TSharedPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FShooterMenuItem</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> FPSOption</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** 是否开启FPS显示 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint8 bFPSOpt </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/** FPS开关控制器*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ToggleFPS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TSharedPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FShooterMenuItem</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> MenuItem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> int32 MultiOptionIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在<code>FShooterOptions::Construct()</code>方法中，在OptionItem中添加一项FPSOption，将ToggleFPS方法绑定到<code>FOnOptionChanged</code>代理对象上，当选项被玩家更改后就会调用<code>SShooterMenuWidget::ChangeOption(int32 MoveBy)</code>中的<code>OnOptionChanged.ExecuteIfBound(...)</code>执行函数<code>ToggleFPS</code>．</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">FPSOption </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">MenuHelper</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">AddMenuOptionSP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OptionsItem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">LOCTEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fps&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FPS&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> OnOffList</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">FShooterOptions</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">ToggleFPS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>编写实际运行的<strong>ToggleFPS()</strong>函数，将<code>bFPSOpt</code>同步到该客户端的PlayerController的<code>bFPSEnabled</code>属性上。其间夹杂<code>bFPSOpt</code>、<code>FPSOption</code>的默认设置和Get、Set方法的调用不过多赘述．</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">FShooterOptions</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">ToggleFPS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TSharedPtr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FShooterMenuItem</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> MenuItem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> int32 MultiOptionIndex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   bFPSOpt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MultiOptionIndex </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   APlayerController</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> BaseController </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Cast</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">APlayerController</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">UGameplayStatics</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">GetPlayerController</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PlayerOwner</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetWorld</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetOwnerUserIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   AShooterPlayerController</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> ShooterPlayerController </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Cast</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">AShooterPlayerController</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">UGameplayStatics</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">GetPlayerController</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PlayerOwner</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetWorld</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetOwnerUserIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">ensure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseController</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BaseController</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ShooterPlayerController</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ShooterPlayerController</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">bFPSEnabled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bFPSOpt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>当点按 APPLY CHANGES 按钮后，将FPSOption当前index存入UShooterPersistentUser实例对象中，而后<code>SaveGameToSlot</code>中用于下次启动游戏加载先前设置．</p><p>创建继承自<code>UUserWidget</code>的<strong>BP_FPSWidget蓝图</strong>，创建富文本组件命名为<code>FPSRichText</code>，蓝图中计算帧数并赋值给<code>FPSRichText—Content</code>．</p><p><img src="/Website/assets/images/BP_FPSWidget-bf0177c3ea8df98b80fd62f935b30f0d.png"></p><p>和题目二使用同样方法获取BP_FPSWidget蓝图资源，在<code>ShooterHUD.cpp</code>中创建实例，在DrawHUD()方法中根据当前<code>AShooterPlayerController::bFPSEnabled</code>正确生成Widget．</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//显示FPS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">FPSWidget</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   FPSWidget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CreateWidget</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">UUserWidget</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MyPC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">FPSWidgetClass</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FPSWidget</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">IsInViewport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> MyPC</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">bFPSEnabled </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   FPSWidget</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">RemoveFromViewport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">FPSWidget</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">IsInViewport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> MyPC</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">bFPSEnabled </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   FPSWidget</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">AddToViewport</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><hr><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目四-1">题目四<a class="hash-link" href="#题目四-1" title="Direct link to heading">​</a></h3><p>将局内的游戏菜单升级为3D UI (WidgetInteractionComponent) ，当菜单显示时，根据玩家位置始终显示在玩家侧前方，且可以正常点击</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-8">实现效果<a class="hash-link" href="#实现效果-8" title="Direct link to heading">​</a></h4><p>按X键呼出3D UI，并且切换为TPP视角，镜头指向按钮，鼠标右键能够点击3D按钮</p><p>实现了3D UI，根据玩家位置始终显示在玩家侧前方，能够正常点击，通过点击3D UI能够在单机模式下播放人物动画</p><p><img src="/Website/assets/images/3DUI-2f1143912589f102dd39f15b3f33597b.png"></p><p>点击进行播放动画</p><p><img src="/Website/assets/images/3DUI点击-ca3777a728f24d0c014c4f250ca97f6e.png"></p><p>（为了优化原项目TPP视角，将PlayerPawn的各个组件置为新的层级关系，相机组件上添加一个 SpringArm 组件）</p><p><img src="/Website/assets/images/PlayerPawn组件层级-cf70b5c4cc249bce2b17849a7f00ee98.png"></p><p>（因为原项目UI界面都用HUD实现，时间不够将其全部重写，故实现如上所述的3D UI，未改变升级局内UI）</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-8">解决办法<a class="hash-link" href="#解决办法-8" title="Direct link to heading">​</a></h4><ol><li><p>创建一个<strong>widget蓝图</strong>名为 <strong>DanceOption</strong></p><p>为其添加三个按钮并给每个按钮附着上文字（代表舞蹈的名称）</p></li></ol><p><img src="/Website/assets/images/DanceOption蓝图-6de722020e864a81796a8961162e2ec3.png"></p><p>​		修改按钮的Appearance——Style——Normal、Hovered、Pressed的属性，实现部		分透明的UI控件，更加美观</p><p><img src="/Website/assets/images/按钮样式-6689f6ef9c9b4c59dc0deebf59bd5c27.png"></p><p>​		为按钮添加点击事件</p><ol start="2"><li><p>为PlayerPawn添加一个<strong>Widget组件</strong>，Widget Class 选定为 <strong>DanceOption</strong> </p><p>调整其层级关系和相对坐标旋转，置于人物侧前方</p></li></ol><p><img src="/Website/assets/images/FPPDanceOption组件-d8f5ea346597582eaf72869b9b53e729.png"></p><ol start="3"><li><p>TPPCamera下添加 <strong>widgetinteraction组件</strong>，设置交互距离</p><p>事件蓝图中使用<code>Press Pointer Key</code>节点用鼠标右键模拟左键的按下和释放</p><p><img src="/Website/assets/images/3DUMG交互蓝图-6b9204b2cb180a56d13325a66adb2bd0.png"></p><p>实现了角色按X键呼出3D UI且始终显示在玩家侧前方， 并且通过右键点击，进行舞蹈的播放</p></li></ol><hr><h2 class="anchor anchorWithStickyNavbar_y2LR" id="基本物理">基本物理<a class="hash-link" href="#基本物理" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目一-2">题目一<a class="hash-link" href="#题目一-2" title="Direct link to heading">​</a></h3><p>不同的地面有不同的摩擦力</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-9">实现效果<a class="hash-link" href="#实现效果-9" title="Direct link to heading">​</a></h4><ol><li><p>场景内的floor_5_Glass的物理材质被重载为自定义的&quot;M_Glass&quot;</p><p>修改地图此处floor_5_Glass玻璃的物理材质</p></li></ol><p><img src="/Website/assets/images/修改玻璃物理材质-a3d1dfcbb060db23be2ef57bd0c5dabb.png"></p><ol start="2"><li><p>两个滑块在不同的物理材质表面下滑得到不同的物理效果</p><p>开始下落</p><p><img src="/Website/assets/images/开始下落-86668f00af7895ad3ab62064868e7b61.png"></p><p>结束下落</p><p><img src="/Website/assets/images/结束下落-d0d3f61c1a76bbfa6008aba8b36ff48d.png"></p></li></ol><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-9">解决办法<a class="hash-link" href="#解决办法-9" title="Direct link to heading">​</a></h4><p>自定义的M_Glass的属性如下:</p><p><img src="/Website/assets/images/Glass物理材质-51bf644bb1193248196a6fbf7ea1a7d0.png"></p><p>自定义的M_Grass的属性如下:</p><p><img src="/Website/assets/images/Grass物理材质-1c6d9a3887166e1264ec3541bf317aef.png"></p><ol><li>设置场景中地板floor_5_Glass的物理材质为&quot;M_Glass&quot;</li></ol><p><img src="/Website/assets/images/玻璃碰撞属性-4cf1944b898bb68bd03c65d76bb9a764.png"></p><ol start="2"><li><p>模拟物理后</p><ul><li><p>左边草地附着M_grass物理材质，摩擦力很大，无法平稳下滑</p></li><li><p>右边草地附着M_glass物理材质，摩擦力为0，能够下滑且速度很快</p></li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目二-2">题目二<a class="hash-link" href="#题目二-2" title="Direct link to heading">​</a></h3><p>​	步枪子弹击中垃圾桶，可以把垃圾桶打飞</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-10">实现效果<a class="hash-link" href="#实现效果-10" title="Direct link to heading">​</a></h4><p>步枪子弹射击垃圾桶，垃圾桶根据不同的受击位置和方向，对应产生被击打的物理效果</p><p>击中效果能够多端同步</p><p><img src="/Website/assets/images/射击垃圾桶-d6f7c0686349fbe2e94b99c707ec0c70.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-10">解决办法<a class="hash-link" href="#解决办法-10" title="Direct link to heading">​</a></h4><p>设置垃圾桶物体的一些基本要素</p><ul><li>给垃圾桶的静态网格体添加简单碰撞</li><li>设置场景中的实例为&quot;可移动的&quot;</li><li>勾选&quot;物理——模拟物理&quot;；</li><li>质量、线性阻尼、角阻尼调整参数</li><li>为场景中的每个垃圾桶实例添加一个Tag：&quot;Trash&quot;</li></ul><p>设置组播方法<code>ProcessTrash()</code>，处理垃圾桶被子弹击中的效果</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** 对垃圾桶做出子弹碰撞反应 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">UFUNCTION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UnReliable</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">NetMulticast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ProcessTrash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FHitResult</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> ShootDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterWeapon_Instant</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">ProcessTrash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FHitResult</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> ShootDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Impact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">AddImpulseAtLocation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ShootDir </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5000.0f</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ImpactPoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>AShooterWeapon_Instant::ProcessInstantHit_Confirmed(...)</code>函数处理子弹射击产生的效果，在其中根据射线返回值判断击中物体的Tag是否包含&quot;Trash&quot;，如果包含则将 HitResult引用和传递方向 ShootDir 传递进方法，并执行</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterWeapon_Instant</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">ProcessInstantHit_Confirmed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FHitResult</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Origin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> ShootDir</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> int32 RandomSeed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> ReticleSpread</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//判断是否击中的为垃圾桶，处理垃圾桶受击反馈</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Impact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bBlockingHit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Impact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">Tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Trash&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">IsRootComponentMovable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">ProcessTrash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Impact</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ShootDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><hr><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目三-2">题目三<a class="hash-link" href="#题目三-2" title="Direct link to heading">​</a></h3><p>发射器发射的炮弹，呈抛物线飞行，碰到障碍可以反弹，碰到敌人或者倒计时结束则爆炸</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-11">实现效果<a class="hash-link" href="#实现效果-11" title="Direct link to heading">​</a></h4><p>角色的炮弹武器，子弹实例能够呈抛物线飞行，倒计时结束时发生爆炸</p><p><img src="/Website/assets/images/炸弹抛物线-b2924d751a23639ace3cda9377dc39cf.png"></p><p><img src="/Website/assets/images/炸弹弹射-46c1c57caa6970d56dde78538b28ce88.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-11">解决办法<a class="hash-link" href="#解决办法-11" title="Direct link to heading">​</a></h4><p>发射器炮弹蓝图继承 AShooterProjectile 类，在其构造函数中修改属性和调参：启用弹力、设置弹性和设置重力</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token class-name">AShooterProjectile</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">AShooterProjectile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FObjectInitializer</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> ObjectInitializer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ObjectInitializer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MovementComp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">bShouldBounce </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MovementComp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">Bounciness </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MovementComp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ProjectileGravityScale </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>实现炮弹呈抛物线状发射，并可以在障碍物间反弹，倒计时结束爆炸</p><hr><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目四-2">题目四<a class="hash-link" href="#题目四-2" title="Direct link to heading">​</a></h3><p>角色面对墙壁时可以施展蹬墙二段跳，不用表现出蹬墙的动画，只需要满足面对墙壁足够近才能施展这个条件</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-12">实现效果<a class="hash-link" href="#实现效果-12" title="Direct link to heading">​</a></h4><p>玩家能够在贴近墙体时，能够施展二段跳，且第二跳高度更高</p><p><img src="/Website/assets/images/二段跳-bbf19e047ebe6a293bd6dcc84d6cdebd.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-12">解决办法<a class="hash-link" href="#解决办法-12" title="Direct link to heading">​</a></h4><p>玩家类 AShooterCharacter 继承自 ACharacter类，ACharacter类中存在 JumpMaxCount 属性，表示最大跳跃次数</p><p>在AShooterCharacter类构造函数中将 <code>JumpMaxCount </code>置为2，使角色能够跳跃2次；<code>bCanDoubleJump</code>用来判断是否可以进行二段跳</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/** 是否能进行二段跳 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">VisibleDefaultsOnly</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Category </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Pawn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> bCanDoubleJump</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">AShooterCharacter</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">AShooterCharacter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FObjectInitializer</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> ObjectInitializer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ObjectInitializer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SetDefaultSubobjectClass</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">UShooterCharacterMovement</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ACharacter</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">CharacterMovementComponentName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bCanDoubleJump </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JumpMaxCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>为场景中的墙体碰撞体积设置Tag为&quot;Wall&quot;</p><p>定义<code>OnHit</code>函数，将其绑定在多播委托变量OnComponentHit上，根据Tag判断角色的胶囊体是否碰撞了墙体,如果碰撞墙体并且现在进行了第一次跳跃，<code>bCanDoubleJump = true</code>，角色可以二段跳</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/*当角色碰撞物体时会调用的函数。*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">UFUNCTION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">OnHit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UPrimitiveComponent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> HitComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> AActor</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> OtherActor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> UPrimitiveComponent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> OtherComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FVector NormalImpulse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FHitResult</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Hit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterCharacter</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">BeginPlay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Super</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">BeginPlay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">GetCapsuleComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">SetNotifyRigidBodyCollision</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">GetCapsuleComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetBodyInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">bNotifyRigidBodyCollision </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">GetCapsuleComponent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> OnComponentHit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddDynamic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">AShooterCharacter</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">OnHit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterCharacter</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">OnHit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UPrimitiveComponent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> HitComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> AActor</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> OtherActor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UPrimitiveComponent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> OtherComponent</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FVector NormalImpulse</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FHitResult</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Hit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JumpCurrentCount </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> OtherActor</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">Tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Wall&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bCanDoubleJump </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在<code>OnStartJump()</code>和<code>OnStopJump()</code>方法中定义二段跳的触发条件，并且在第二跳发生时将Z轴速度提高，停止跳跃时将<code>JumpZVelocity</code>重置为720.0f</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterCharacter</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">OnStartJump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AShooterPlayerController</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> MyPC </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Cast</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">AShooterPlayerController</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Controller</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MyPC </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> MyPC</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">IsGameInputAllowed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JumpCurrentCount </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   bPressedJump </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JumpCurrentCount </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> bCanDoubleJump</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">GetCharacterMovement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">JumpZVelocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000.0f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bPressedJump </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterCharacter</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">OnStopJump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bPressedJump </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">StopJumping</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JumpCurrentCount </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bCanDoubleJump </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">GetCharacterMovement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">JumpZVelocity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">720.0f</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>实现蹬墙二段跳的效果，并且第二条速度更大，使角色能跳上场景中大部分墙体。</p><hr><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目五-1">题目五<a class="hash-link" href="#题目五-1" title="Direct link to heading">​</a></h3><p>步枪子弹可以穿过一定厚度的墙，伤害随穿过障碍的厚度递减</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-13">实现效果<a class="hash-link" href="#实现效果-13" title="Direct link to heading">​</a></h4><p>子弹可以穿墙打击敌人，子弹穿透墙体的伤害会根据在墙体中的移动距离进行衰减</p><p>并且在墙体位置仍旧存留弹孔、击中特效等效果</p><p><img src="/Website/assets/images/子弹穿墙击杀-c55559575deb969bbe93bd4ded964d7c.png"></p><p><img src="F:%5C2021-2023%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E8%B5%84%E6%BA%90%5C2021%E8%85%BE%E8%AE%AF%E6%B8%B8%E6%88%8F%E9%AB%98%E6%A0%A1%E5%85%AC%E5%BC%80%E8%AF%BE%5C%E8%AF%BE%E7%A8%8B%E4%BD%9C%E4%B8%9A%5CFinished_%E5%9F%BA%E6%9C%AC%E7%89%A9%E7%90%86-11%E6%9C%887%E6%97%A5%5Csrc%5C%E5%AD%90%E5%BC%B9%E4%BC%A4%E5%AE%B3%E8%A1%B0%E5%87%8F.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-13">解决办法<a class="hash-link" href="#解决办法-13" title="Direct link to heading">​</a></h4><p>在 ShooterWeapon_Instant.h 中声明需要的属性和方法</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">AShooterWeapon_Instant</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause class-name">public</span><span class="token base-clause"> </span><span class="token base-clause class-name">AShooterWeapon</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">protected</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 子弹穿过墙体递减后的伤害值*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Replicated</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int32 AfterDecreaseDamage</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 穿墙是否进行伤害递减*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Replicated</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> bDecreaseDamage</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/** 处理伤害递减</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * @return 递减后的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DamageDecrease</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">float</span><span class="token plain"> CrossLength</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/*判断墙后是否存在Pawn，有的话返回被击中Pawn的HitResult，没有的话返回击中物体*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FHitResult </span><span class="token function" style="color:#d73a49">HavePawnBackWall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FHitResult</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> End</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> ShootDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>定义<code>FHitResult HavePawnBackWall(...)</code>函数,用于判断子弹是否穿过墙体击中了敌人。</p><ol><li><p>从玩家枪口方向<strong>发射一条射线</strong>，定义碰撞通道为OverLap（为了确保Overlap射线检测正确，射线忽略了地图中一些体积，比如<code>AudioTrigger_Atrium</code>），防止碰到第一个实体停止检测</p></li><li><p>根据射线获得的<strong>HitResult数组</strong>，(纯OverLap通道会多次重叠自身的组件和本身)遍历数组先获得需要排除的自身个数SelfNum</p></li><li><p>根据标签判断下一个重叠的是否是墙体，如果是则继续判断下一个重叠的是否为Pawn</p></li><li><p>如果为真则从击中pawn的位置反向发射射线</p></li><li><p>多个Hit结果中可以提取出来穿透墙体的前后两点：击中墙体的位置、反向射线击中墙体的位置，做差，得出<code>CrossLength</code>为穿过的长度</p><p>（图中为Debug出穿透的墙体的前后两点，用两个黄点表示出来）</p></li></ol><p><img src="/Website/assets/images/穿透墙体的两个点-5b6b9d1c6edda8be34ff1f4584c5a80c.png"></p><p>使用公式 $AfterDecreaseDamage = HitDamage - CrossLength / 10.0f$ </p><p>将伤害衰减后存入<code>AfterDecreaseDamage</code>，为负则不行进伤害判定</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">FHitResult </span><span class="token class-name">AShooterWeapon_Instant</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">HavePawnBackWall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FHitResult</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> End</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> ShootDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TArray</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">FHitResult</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Hits</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//Trace遍历子弹路径中穿过的物体</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">UKismetSystemLibrary</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">LineTraceMulti</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">GetWorld</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">End</span><span class="token punctuation" style="color:#393A34">,</span><span class="token class-name">UEngineTypes</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">ConvertToTraceType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ECC_GameTraceChannel4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ActorsToIgnore</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">EDrawDebugTrace</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Hits</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">FLinearColor</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">Blue</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">FLinearColor</span><span class="token operator" style="color:#393A34">::</span><span class="token plain">Red</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">20.0f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> SelfNum </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//检测到几个自己，确定SelfNum值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Hits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Num</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//前序碰到的都是自己</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">Hits</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Compare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetPawnOwner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SelfNum</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//检测是否直接击中墙体，若无直接返回原Hit结果</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Hits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Num</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> SelfNum</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">Hits</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SelfNum</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">Tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Wall&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Hits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Num</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> SelfNum</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Hits</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SelfNum </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">Tags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">TEXT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Player&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//UE_LOG(LogTemp,Warning,TEXT(&quot;Get Actor!!!&quot;));</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FHitResult Hit</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//从击中敌人Pawn的位置向出发点发射Trace，  HitTrace即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">GetWorld</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">LineTraceSingleByChannel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Hit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Hits</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SelfNum</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Location</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> COLLISION_WEAPON</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//做差，从而得出子弹穿过墙体的长度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">DamageDecrease</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">FVector</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">Distance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Hits</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SelfNum</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Location</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Hit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Location</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bDecreaseDamage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Hits</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">SelfNum </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">AfterDecreaseDamage </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bDecreaseDamage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>AShooterWeapon_Instant::DealDamage</code>中判断是否进行伤害递减，进行伤害最终传入</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterWeapon_Instant</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">DealDamage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FHitResult</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FVector</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> ShootDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   FPointDamageEvent PointDmg</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PointDmg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DamageTypeClass </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstantConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DamageType</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PointDmg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HitInfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Impact</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   PointDmg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ShotDirection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ShootDir</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">InstantConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bDecreaseDamage</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PointDmg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Damage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstantConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AfterDecreaseDamage</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      PointDmg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Damage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InstantConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HitDamage</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">//处理伤害</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Impact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">TakeDamage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PointDmg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Damage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PointDmg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MyPawn</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">Controller</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在<code>AShooterWeapon_Instant::FireWeapon()</code>中，判断第一次射线和<code>HavePawnBackWall()</code>的返回值是否为一个Hit结果</p><ul><li>如果两个Hit值相等，则没发射穿墙事件</li><li>否则发生穿墙事件，在原Impact击中位置生成打击效果</li></ul><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> FHitResult Impact </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">WeaponTrace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">StartTrace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EndTrace</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*查询墙后是否有pawn*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FHitResult FinalImpact </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">HavePawnBackWall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Impact</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">StartTrace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">EndTrace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ShootDir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//墙面依旧留下弹痕</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Impact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsValidBlockingHit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> FinalImpact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsValidBlockingHit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Impact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Compare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">FinalImpact</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetActor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">GetNetMode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> NM_DedicatedServer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token function" style="color:#d73a49">SpawnImpactEffects</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Impact</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>实现子弹穿墙打击敌人，子弹穿透墙体的伤害能够根据在墙体中移动的距离进行衰减，墙上仍产生弹孔</p><hr><h2 class="anchor anchorWithStickyNavbar_y2LR" id="骨骼动画">骨骼动画<a class="hash-link" href="#骨骼动画" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="操作说明">操作说明<a class="hash-link" href="#操作说明" title="Direct link to heading">​</a></h3><p>1、Ctrl+1/2/3播放三种不同的舞蹈动画</p><p>2、X键呼出3D UI，瞄准按钮并点按鼠标右键，能够在单机模式下播放人物动画</p><p>3、按Z能够使角色蹲下</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目一-3">题目一<a class="hash-link" href="#题目一-3" title="Direct link to heading">​</a></h3><p>按键（ctrl+数字键）可以触发角色不同的表演动作</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-14">实现效果<a class="hash-link" href="#实现效果-14" title="Direct link to heading">​</a></h4><p>Ctrl+1/2/3播放三种不同的舞蹈动画，并自动切换第三人称</p><p><img src="/Website/assets/images/跳舞1-8cdbfcfe4bee4fbb6aa98c770712f025.png"></p><p>X键呼出3D UI，瞄准按钮并点按鼠标右键，能够在单机模式下播放人物动画</p><p><img src="/Website/assets/images/3DUI-2f1143912589f102dd39f15b3f33597b.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-14">解决办法<a class="hash-link" href="#解决办法-14" title="Direct link to heading">​</a></h4><h5 class="anchor anchorWithStickyNavbar_y2LR" id="修复原项目bug">修复原项目bug<a class="hash-link" href="#修复原项目bug" title="Direct link to heading">​</a></h5><p>先修复了原项目出现的bug，第三人称可视第一人称手臂mesh、无法看到第三人称枪械</p><p>AShooterCharacter::UpdatePawnMeshes()中添加逻辑判定，在不同模式下，隐藏不需要的人物和枪械mesh</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterCharacter</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">UpdatePawnMeshes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> bFirstPerson </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">IsFirstPerson</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//TPP不需要看见人物mesh和枪械mesh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">IsLocallyControlled</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//切换武器可见性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Inventory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Num</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">int32 i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> Inventory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Num</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Inventory</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Inventory</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">Mesh1P</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">SetOwnerNoSee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">bFirstPerson</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Inventory</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">Mesh3P</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">SetOwnerNoSee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bFirstPerson</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>又通过添加SprinArm和调节一下组件层级关系，修复了第三人称视角怪异的bug</p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="动画素材格式转换">动画素材格式转换<a class="hash-link" href="#动画素材格式转换" title="Direct link to heading">​</a></h5><p>使用Mixamo_Converter软件，获取体重提供的角色3D模型，将其导入到Mixamo网站</p><p>选择3种舞蹈动画进行下载，再使用Mixamo_Converter软件将下载的fbx准换为UE4可以使用的格式</p><p>将转换好后的动画素材导入到UE4中，为官方小白人模型的动画</p><p><img src="/Website/assets/images/小白人动画-ec9410c8eb69c57ba6413260af212d1b.png"></p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="骨骼重定向">骨骼重定向<a class="hash-link" href="#骨骼重定向" title="Direct link to heading">​</a></h5><p>重定向原项目人物骨骼，对比两个骨骼位置，全部手动添加并调试</p><p>(花费了大量时间😭，不一一列举)</p><p><img src="/Website/assets/images/骨骼重定向-7f99bfa80baebf8436e9bfe138a4ced0.png"></p><p>再将骨骼节点的 Translation Retarget 选项慢慢调试：为动画或骨骼</p><p><img src="/Website/assets/images/Translation_Retarget-e965c17299f3dededa382557ee7632f8.png"></p><p>经过漫长的调参，尽量保证重定向后骨骼动画不至于拉伸严重</p><p>最后终于到了重定向骨骼的一步</p><p><img src="/Website/assets/images/重定向操作-a536b3f77261ed3bbe20e7d7cb782b78.png"></p><p>得到相对较好的动画资源</p><p>将动画资源转为Montage，并且Slot设置为Full Body，并且改为根骨骼移动(防止mesh和collision不在一个位置)</p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="设置输入播放动画">设置输入、播放动画<a class="hash-link" href="#设置输入播放动画" title="Direct link to heading">​</a></h5><p>cpp中使蓝图能够调用<code>TogglePerspective()</code>，从而调节TPP和FPP视角；</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">UFUNCTION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BlueprintCallable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TogglePerspective</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">UPROPERTY</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BlueprintReadWrite</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> IsFPP</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>在人物蓝图中设置输入并播放动画</p><p>输入事件在Dance中播放Montage，并且在播放中禁止任何输入(防止出现边跳舞边开枪的bug)delay相应的跳舞时间后启用输入操作</p><p>整体蓝图如下所示</p><p><img src="/Website/assets/images/人物Dance蓝图-d7d11444661b9611aec5fae1a06dfdab.png"></p><p>Dance方法实现如下，设置必要的状态参数，并且在播放动画时自动切换第三人称</p><p><img src="/Website/assets/images/Dance方法-00d4a124639363526bc5c75d1052b7a5.png"></p><p>实现了按键播放人物动画，3D UI 启用动画在UMG中有详细解释</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目二-3">题目二<a class="hash-link" href="#题目二-3" title="Direct link to heading">​</a></h3><p>主角静止无输入5秒之后进入idle休闲动画，如耸肩、挠头等</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-15">实现效果<a class="hash-link" href="#实现效果-15" title="Direct link to heading">​</a></h4><p>主角静止无输入5秒之后进入耸肩动画，同一无操作间隔内只进行一次，且不会与其他动画冲突</p><p><img src="/Website/assets/images/耸肩-09e1f10eef80a9cde0c6846d22aa4cb2.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-15">解决办法<a class="hash-link" href="#解决办法-15" title="Direct link to heading">​</a></h4><p>同题目一步骤制作蒙太奇<strong>耸肩动画</strong></p><p><img src="/Website/assets/images/耸肩动画-67682dcd537d0d61a0c230c47ee63f12.png"></p><p>Tcik计时，无数入进行5秒后，播放耸肩动画，有输入就停止播放</p><ul><li>跳舞时间内不会播放耸肩动画</li><li>下蹲时不会播放</li></ul><p><img src="/Website/assets/images/耸肩蓝图-066824fc3da143c7f8d7687381013491.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目三-3">题目三<a class="hash-link" href="#题目三-3" title="Direct link to heading">​</a></h3><p>蹲姿及其配套的基础移动动作</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-16">实现效果<a class="hash-link" href="#实现效果-16" title="Direct link to heading">​</a></h4><p>（动画重定向，手臂位置拉伸太大，功能都已实现，动画不适配的bug还未能修复😭）</p><p>人物按Z键能够实现蹲姿，同时减慢移动速度和减少胶囊体半高</p><p><img src="/Website/assets/images/蹲姿-1c9b73729e9bff87486b88bbce31bb54.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-16">解决办法<a class="hash-link" href="#解决办法-16" title="Direct link to heading">​</a></h4><p>人物移动组件Character movement 中勾选<strong>can crouch</strong> ✔️</p><p>修改<strong>移动速度</strong></p><p>（漫长的找素材过程，很遗憾骨骼重定向后人物手臂位置拉伸还是很严重）</p><p>通过蹲姿前进、后退、左移、右移等动画制作<strong>混合空间</strong>，设置横纵轴的参数和范围，横轴用来确定方向，纵轴对应人物移动速度</p><p><img src="/Website/assets/images/蹲姿混合空间轴-3ebbacec35c977a753207a28e4f112b6.png"></p><p><img src="/Website/assets/images/混合空间-484d14f2acd15ca5d1685f2a1b826bf7.png"></p><p><strong>人物事件蓝图</strong>中设置<strong>按键Z进行下蹲</strong>，并相应的改变FPP相机高度和胶囊体半高</p><p><img src="/Website/assets/images/蹲姿事件蓝图-37e28bac5c5ef4635ebc0bda36e6df7a.png"></p><p>动画蓝图中新建<strong>Crouch状态机</strong>，Entry直连Crouch状态，设置对应的输入值</p><p><img src="/Website/assets/images/Crouch状态机-5193325bea4b23131b42f6f87932fdbb.png"></p><p>将原动画缓存为 SavedPose_OriginMovement ，Crouch状态机缓存为 SavedPose_Crouch ，使用波尔值Is Crouch和Blend Poses by Bool节点Blend动画</p><p>​	<img src="/Website/assets/images/混合蹲姿动画-573e3c07733f720d681302589aa092df.png"></p><p>实现按Z轴切换蹲姿和站立，不同方向的混合移动动画</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目四-3">题目四<a class="hash-link" href="#题目四-3" title="Direct link to heading">​</a></h3><p>停步动作，并优化其衔接表现</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-17">实现效果<a class="hash-link" href="#实现效果-17" title="Direct link to heading">​</a></h4><p>添加跑动结束停步动画</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-17">解决办法<a class="hash-link" href="#解决办法-17" title="Direct link to heading">​</a></h4><p>导入两只脚的停步动画</p><p>定义变量Is Right Foot 用于判断当前为哪只脚准备着地</p><p>在跑步动画关键帧中设置Notify事件RightFoot、LeftFoot</p><p><img src="/Website/assets/images/跑步通知事件-4d80d6a97b411728d6dc220b474852ad.png"></p><p>在动画蓝图中用Notify事件给Is Right Foot 赋值</p><p><img src="/Website/assets/images/Notify-e0d33e9c99e29aa97b80e0ee3eba5207.png"></p><p>在状态机中添加一个状态,并设置相应的转换条件，当Speed&lt;100.0f时进入动画</p><p><img src="/Website/assets/images/跑动状态机-d8ed429df1f99151db92e8995f2fe7e2.png"></p><p>（导入的动画和跑步动画不适配，表现比较僵硬）</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目五-2">题目五<a class="hash-link" href="#题目五-2" title="Direct link to heading">​</a></h3><p>脚部的IK功能</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-18">实现效果<a class="hash-link" href="#实现效果-18" title="Direct link to heading">​</a></h4><p>实现<strong>脚步IK功能</strong>，人物踏入不同高度的地面脚部会放置在不同高度（稍微有些内八）</p><p><img src="/Website/assets/images/脚步IK-e8dbfbeb24575276672abcfa1f80fa5a.png"></p><p><img src="/Website/assets/images/前视图-2921e8afee873759cea7b8c5e50dcf73.png"></p><p>并且脚面能够进行<strong>旋转，从而贴合地面</strong></p><p><img src="/Website/assets/images/脚步旋转-b4545a716544e7aa11aa678ca982e462.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-18">解决办法<a class="hash-link" href="#解决办法-18" title="Direct link to heading">​</a></h4><p>在角色左右脚骨骼添加插槽名为&quot;<code>LeftFootSocket</code>&quot;、&quot;<code>RightFootSocket</code>&quot;，为了后续获得此点的坐标信息；</p><p><img src="/Website/assets/images/Socket-5e6b511e60c7e3c9789d9f29cd91a6cc.png"></p><p>构造函数中确定部分定义变量的值</p><ul><li><code>Scale</code>：角色比例</li><li><code>Foot Offset</code>：脚部插槽位置和脚底位置的差，用于解决脚部骨骼的位置并不在脚后跟的下面导致的脚步下陷问题</li><li><code>Capsule Half Height</code>：初始胶囊体半高，用于后续修改胶囊体半长，防止角色上方空出碰撞部分</li></ul><p><img src="/Website/assets/images/IK构造函数-9e1c90ae154a09497cb2946eebc9e6c3.png"></p><p>通过射线检测，确定角色脚部需要抬高的偏移量，从而确定角色的脚实际应该摆放的位置。</p><p>角色蓝图中 PlayerPawn 中声明并定义<code>IK Foot Trace</code>方法，输入插槽名称和射线长度<code>TraceDistance</code>，世界坐标下向脚步下方插槽位置发射一条垂直射线，并返回<code>IKOffset</code>(脚部偏移量)</p><p><img src="/Website/assets/images/IK_Foot_Trace-25579937ce3e2f7bc46aa554ed99aeef.png"></p><p>角色Event Graph中， Event Tick 调用<code>IK Foot Trace</code>方法，将返回值Lerp后存入<code>IKoffsetRightFoot</code>、<code>IKoffsetLeftFoot</code>(插值左右脚实际该偏移的长度)中，使值平滑变动。 </p><p><img src="/Website/assets/images/获取脚步Offset-56f505a31c61dcf173dcd4bfa53e6164.png"></p><p>获得了上述变量值，进而在动画蓝图中使用两个<strong>Two Bone IK</strong>节点，设置两个节点的<code>IKBone</code>、<code>Effector</code>、<code>Joint Target</code>，确保坐标空间为<code>Bone Space</code>,图中展示右脚部分的设置，左脚同理</p><p><img src="/Website/assets/images/Two_Bone_IK-8e945d664a08e7af93bffafd624ce760.png"></p><p><img src="/Website/assets/images/Two_Bone_IK设置-065f3539d393854b04ba6f85f4abb817.png"></p><p>在动画蓝图中定义<code>RightFootEffectorLocation</code>、<code>LeftFootEffectorLocation</code>，根据之前求出的左右脚偏移量，将其作为X值，赋值<code>RightFootEffectorLocation</code>、<code>LeftFootEffectorLocation</code>，根据左右脚的坐标系不同，确定两个变量的X值正负（因为根据的坐标系是基于左右脚的，脚部竖直向上位移的时候，变化的是Effector Location—X轴，并且左右脚还是相反的）</p><p><img src="/Website/assets/images/获得Effector_Location-8b95938ac9883a5f6e358c1b46617045.png"></p><hr><p><strong>解决角色被碰撞体挡住，不能进行脚步IK问题：</strong></p><p>在碰撞体宽度大的情况下，物体骨骼无法到达下一台阶的位置，也无法使用实现IK，通过<strong>把整体骨骼拉到下一级台阶，同时缩小胶囊体的半高</strong>解决</p><p>定义<code>Mesh Offset Z</code>变量，其值通过左右脚偏移量做差取绝对值负数获得，从而确定整体骨骼向下的偏移量，使用Transform(Modify) Bone节点将整体骨骼位置拉低，节点控制根骨骼在世界坐标的偏移。</p><p><img src="/Website/assets/images/Transform_Bone-ea2627a54c9262a21549062e4e65775d.png"></p><p>拉低根骨骼的同时，人物上方会空出碰撞区域，同时根据<code>Mesh Offset Z</code>将碰撞体半场高修改解决问题</p><p><img src="/Website/assets/images/修改半场高-9b6ac82d0e49a62bf61dbf4e074e9da4.png"></p><hr><p><strong>解决脚部插槽高度与脚底高度不同，脚陷入问题：</strong></p><p>在脚底新建插槽，计算插槽与脚部插槽的高度差值<code>FootOffset</code>，在偏移量中加入此值，解决脚部有点陷入地面问题</p><hr><p><strong>实现脚面贴合不同角度平面：</strong></p><p>在动画蓝图中添加两个<code>Transform（Modify）Bone</code>节点，用来更改左右脚的<code>Rotation</code>，将其分别关联在两只脚的骨骼上，并且在世界坐标下旋转</p><p><img src="/Website/assets/images/改变脚部角度蓝图-e8d4cff7d2b51576037b9aac8f26ee1f.png"></p><p>根据射线HitResult的法向量信息，求解脚部该旋转的Rotator</p><p><img src="/Website/assets/images/图解脚部旋转角度-346c4857a0ca57301ec1bca46e2dcc34.jpg"></p><p><img src="/Website/assets/images/求旋转角-0d1dae3810cbf520225c69496ab0b15a.png"></p><p>将值赋给<code>Transform（Modify）Bone</code>节点的Rotation，实现脚面贴合不同角度平面</p><p><img src="/Website/assets/images/脚部旋转IK-2cfb223ddc0d32842f6166a3e679b16a.png"></p><p>整体动画蓝图</p><p><img src="/Website/assets/images/整体动画蓝图-87bcc991c67e8217ea2de449319af3e1.png"></p><hr><h2 class="anchor anchorWithStickyNavbar_y2LR" id="渲染基础">渲染基础<a class="hash-link" href="#渲染基础" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目一-4">题目一<a class="hash-link" href="#题目一-4" title="Direct link to heading">​</a></h3><p>使用标准材质，把场景地面修改为砖块或木板等均可</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-19">实现效果<a class="hash-link" href="#实现效果-19" title="Direct link to heading">​</a></h4><p>将地图中一块地面的材质修改为橡木板材质</p><p><img src="/Website/assets/images/橡木地板-aa84c07d476f01ab528ec235feb9dcaa.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-19">解决办法<a class="hash-link" href="#解决办法-19" title="Direct link to heading">​</a></h4><p>将此地板的材质—Element2替换为初学者内容包的M_Wood_Oak</p><p><img src="/Website/assets/images/材质面板-30567dc01ee4d3d89bbcafe58cd93961.png"></p><hr><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目二-4">题目二<a class="hash-link" href="#题目二-4" title="Direct link to heading">​</a></h3><p>使用标准材质，把枪械修改为金属</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-20">实现效果<a class="hash-link" href="#实现效果-20" title="Direct link to heading">​</a></h4><p><img src="/Website/assets/images/金属武器-1c4db1281509b3a0875f02e6edd22df0.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-20">解决办法<a class="hash-link" href="#解决办法-20" title="Direct link to heading">​</a></h4><ul><li><p>将武器的主体材质替换为标准材质<code>M_Metal_Burnished_Steel</code>金属材质;</p></li><li><p>武器瞄准镜部分替换为标准材质<code>M_Metal_Steel</code>金属材质;</p></li></ul><p><img src="/Website/assets/images/武器材质-78df0e2ec153c00ecda9f036ddbed655.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目三-4">题目三<a class="hash-link" href="#题目三-4" title="Direct link to heading">​</a></h3><p>添加一种后处理效果</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-21">实现效果<a class="hash-link" href="#实现效果-21" title="Direct link to heading">​</a></h4><p>自定义玻璃材质，修改静态网格体 MainHall_WallGrass_05 的材质，实现屏幕空间反射的后处理效果</p><p><img src="/Website/assets/images/玻璃效果-f39a4724a8d7674a5abf39504c64c05a.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-21">解决办法<a class="hash-link" href="#解决办法-21" title="Direct link to heading">​</a></h4><p>新建材质Glass，设置参数基础颜色、metallic和粗糙度</p><p><img src="/Website/assets/images/Glass-518fe56b9c8c5cb8cdb9604a1890eee3.png"></p><p>生成实例Glass_Inst，赋值颜色为灰色</p><p><img src="/Website/assets/images/Glass_Ins-827bfde88491698ac9aa0e93c03ecf37.png"></p><p>再生成实例Glass_Inst_Inst并赋值颜色Metallic为1.0，实现屏幕空间反射效果</p><p><img src="/Website/assets/images/Glass_Inst_Inst-ab28a532de17bb6f00bcfde493a3f532.png"></p><p><img src="/Website/assets/images/屏幕空间反射材质球-225d091eb0d684496b8cdf7339633fa5.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目四-4">题目四<a class="hash-link" href="#题目四-4" title="Direct link to heading">​</a></h3><p>使用材质编辑器，添加至少一种自定义材质，比如枪械上的UV动画</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-22">实现效果<a class="hash-link" href="#实现效果-22" title="Direct link to heading">​</a></h4><ol><li>将两种枪械的瞄准镜部分添加了UV动画，使枪械表面产生流动的效果</li></ol><p><img src="/Website/assets/images/瞄准镜UV动画-c00ab16ae7d1b7b029dec59a832bb206.png"></p><ol start="2"><li>自定义半透明材质，物体穿过会将轮廓绘制并描绘出亮边</li></ol><p><img src="/Website/assets/images/自定义防御材质-4e00c5c69b9ebfd43a783e3ff5a9570b.png"></p><p>将材质实例应用到Cube上囊括玩家出生点房间，子弹射线不会检测到其中的玩家，但是玩家能够正常穿过这道门，实现<strong>保护玩家在出生点不受外部子弹伤害</strong>的一种机制</p><p><img src="/Website/assets/images/射击防御材质-17285732f14bc022470c2de97a7d8426.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-22">解决办法<a class="hash-link" href="#解决办法-22" title="Direct link to heading">​</a></h4><ol><li>在武器材质蓝图中，给枪械瞄准镜部分纹理添加Panner节点，速度X设置为0.1，从而实现流动效果</li></ol><p><img src="/Website/assets/images/武器材质UV动画-fbdad2780246711521952d7c194c526f.png"></p><ol start="2"><li><p>新建自定义材质，命名为<strong>&quot;Transparency&quot;</strong></p><ul><li>混合模式 为 &quot;半透明&quot;</li><li>着色模型 为 &quot;无光照&quot;</li></ul><p>材质蓝图中创建各节点和参数并连接</p><p><img src="/Website/assets/images/防御材质蓝图-3f9a4ce12f9f8cc1f172069d1b07bf9e.png"></p><p>生成材质实例，并在实例中将各个参数启用并赋值</p><ul><li>Depth：亮边宽度</li><li>Color：原色</li><li>Depth_Color：高亮颜色</li></ul><p><img src="/Website/assets/images/防御材质实例参数-587978f99d37f63f6a74c0b21b77862a.png"></p><p>实现如下效果</p><p><img src="/Website/assets/images/圆弧勾勒轮廓-e7231571ca01ceaacf6fe06a1f1ffb5e.png"></p><p>最后将材质添加到Cube上，Cube囊括玩家出生地，当有玩家穿过能够高亮轮廓，外面的子弹无法打进出生地，实现一种出生保护机制。</p></li></ol><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目五-3">题目五<a class="hash-link" href="#题目五-3" title="Direct link to heading">​</a></h3><p>结合游戏玩法丰富技能特效，比如开火、击中或爆炸特效等</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-23">实现效果<a class="hash-link" href="#实现效果-23" title="Direct link to heading">​</a></h4><p>被击杀的玩家能够不是直接消失，而是先实现消融的材质特效再销毁</p><p><img src="/Website/assets/images/Pawn溶解-80dcd52e180ee2f465c96b089e20e010.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-23">解决办法<a class="hash-link" href="#解决办法-23" title="Direct link to heading">​</a></h4><p>在人物材质的Blend Mode置为Masked，修改并赋值<code>EmissiveColor</code>、<code>OpacityMask</code>节点，将Value参数控制溶解程度，编写材质函数Sine_remapped、MF_Appearacne和材质蓝图，调参实现溶解效果</p><p><img src="/Website/assets/images/溶解材质蓝图-61ee5c434867f8c1a3d833083c1b5700.png"></p><p>Sine_remapped材质函数</p><p><img src="/Website/assets/images/Sine_remapped-8b8cc67da7a323ca595ea8dd856848ec.png"></p><p>MF_Appearacne材质函数</p><p><img src="/Website/assets/images/MF_Appearance蓝图-cd2aeeaf2581d87e8955d409c07a1d64.png"></p><p>基于此材质生成材质实例 HeroTPP_Inst，将Pawn的材质替换；</p><p>在ShooterCharacter.h中声明函数<code>LetPawnDissolve()</code>，使其控制溶解速度</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">UFUNCTION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BlueprintImplementableEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">LetPawnDissolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>蓝图中重写<code>LetPawnDissolve</code>，延迟五秒后，使用TimeLine实现材质参数根据定义的时间线变化。</p><p><img src="/Website/assets/images/EventLetPawnDissolve-522078fb94ae11068561765a65b0fdcc.png"></p><p>人物死亡时调用OnDeath()函数，所以在cpp <code>AShooterCharacter::onDeath()</code>函数中调用蓝图方法LetPawnDissolve()</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterCharacter</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">OnDeath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">LetPawnDissolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>实现人物在死亡后，出现缓慢溶解的特效，再销毁物体</p><p><img src="/Website/assets/images/Pawn溶解2-683a7ea5e9784a093c1ea05b9f8f3a02.png"></p><hr><h2 class="anchor anchorWithStickyNavbar_y2LR" id="ai技术介绍">AI技术介绍<a class="hash-link" href="#ai技术介绍" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目一-5">题目一<a class="hash-link" href="#题目一-5" title="Direct link to heading">​</a></h3><p>通过设置NavMeshBoundsVolume生成地图的导航网格</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-24">实现效果<a class="hash-link" href="#实现效果-24" title="Direct link to heading">​</a></h4><p>通过构建网格体边界体积（Navigation Mesh Bounds Volume），实现地图的导航网格</p><p><img src="/Website/assets/images/导航网格-d292bd90f9a8346fe326f64a02192c47.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-24">解决办法<a class="hash-link" href="#解决办法-24" title="Direct link to heading">​</a></h4><p>添加<strong>寻路网格体边界体积（Navigation Mesh Bounds Volume）</strong></p><p>解决寻路网格体在高度上绘制出现偏差问题，调整绘制寻路网格体的高度偏移将<code>RecastNavMesh-Common ———— Draw offset </code>设置为10.0f</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目二-5">题目二<a class="hash-link" href="#题目二-5" title="Direct link to heading">​</a></h3><p>基于生成的导航网格让角色从两点间自动寻路</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-25">实现效果<a class="hash-link" href="#实现效果-25" title="Direct link to heading">​</a></h4><p>AI角色能够在两点间自动寻路，在到达一个目标点后延迟3秒</p><p><img src="/Website/assets/images/自动寻路A-995b5dc4b61a3e0234af86a603e046a7.png"></p><p><img src="/Website/assets/images/自动寻路B-bc2e16f62c88cf4fbeeb583168a23294.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-25">解决办法<a class="hash-link" href="#解决办法-25" title="Direct link to heading">​</a></h4><p>在BotPawn的事件蓝图中添加MoveToA、MoveToB自定义事件，使用<code>AI Move To</code>节点，互相调用事件，实现AI角色从A坐标和B坐标基于导航网格来回移动寻路。</p><p><img src="/Website/assets/images/自动寻路蓝图-8e143fd5475cd93670f0e68fca1e0629.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目三-5">题目三<a class="hash-link" href="#题目三-5" title="Direct link to heading">​</a></h3><p>在UE4中创建黑板，行为树以及行为树装饰器</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-26">实现效果<a class="hash-link" href="#实现效果-26" title="Direct link to heading">​</a></h4><p>为AI角色创建黑板、行为树及装饰器等等</p><p>AI角色主要有三种行为：</p><ol><li>填充弹药：寻找最近子弹位置，移动到最近的子弹填充处进行子弹填充</li><li>发现敌人并攻击：如果视野内存在敌人，追逐敌人并攻击</li><li>未发现敌人/闲置状态：随机选定巡逻点并移动，实现随机巡逻</li></ol><p><img src="/Website/assets/images/行为树总览-4d0e58f40fb047d88704fcac3e5c3a74.png"></p><p>黑板关键帧</p><ul><li>Enemy<code>(Object)</code>：当前目标敌人，基类ShooterCharacter</li><li>NeedAmmo<code>(Bool)</code>：是否需要子弹，用于判定AI角色子弹是否充裕</li><li>Destination<code>(Vector)</code>：当前的目的地，可以是追逐玩家的位置、随机巡逻点或子弹填充地</li><li>SelfActor<code>(Object)</code>：自己</li><li>HasPlayerInSight<code>(Bool)</code>：在AI角色视线内是否存在敌人</li></ul><p><img src="/Website/assets/images/黑板总览-e5fef0ef1911ebc2ed825d3059d891b1.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-26">解决办法<a class="hash-link" href="#解决办法-26" title="Direct link to heading">​</a></h4><p>后续题目将会相应部分的实现进行解释</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目四-5">题目四<a class="hash-link" href="#题目四-5" title="Direct link to heading">​</a></h3><p>使用行为树的基本节点（选择器、序列节点、平行节点等）以及角色移动组件实现NPC追逐玩家的任务</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-27">实现效果<a class="hash-link" href="#实现效果-27" title="Direct link to heading">​</a></h4><p>AI角色在感知并发现敌人后，能够对发现目标进行追逐并攻击</p><p><img src="/Website/assets/images/追逐玩家-8b99bd747a7b508fc0b9093cc13667d8.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-27">解决办法<a class="hash-link" href="#解决办法-27" title="Direct link to heading">​</a></h4><p>由根连接一个Selector，其上挂载<code>BotSearchEnemyLOS</code>和<code>Shoot An Enemy</code>两个服务</p><p><img src="/Website/assets/images/行为树根-b3cc35cfbbf02c405f13686d0f7f2672.png"></p><ul><li><p>BotSearchEnemyLOS服务：间隔0.5s，调用ShooterAIController中的cpp方法，找到距离最近的Enemy并且给黑板键<code>Enemy</code>赋值，将其设置为当前目标</p></li><li><p>BotShooeEnemy服务：调用<code>AShooterAIController::ShootEnemy()</code>，根据黑板健<code>Enemy</code>、敌人是否存活、当前弹药值等条件判断是否能够进行射击，并且赋值<code>bCanShoot</code>变量，间隔0.5s发射子弹</p><div class="codeBlockContainer_J+bg language-cpp theme-code-block"><div class="codeBlockContent_csEI cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token class-name">AShooterAIController</span><span class="token operator" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">ShootEnemy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> bCanShoot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   AShooterCharacter</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> Enemy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetEnemy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> Enemy </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> Enemy</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">IsAlive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MyWeapon</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetCurrentAmmo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> MyWeapon</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">CanFire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">LineOfSightTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Enemy</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MyBot</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetActorLocation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         bCanShoot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bCanShoot</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      MyBot</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">StartWeaponFire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      MyBot</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">StopWeaponFire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul><p>如果黑板的键<code>Enemy</code>已设置并且AI感知到敌人在视野之内，说明<strong>发现敌人</strong>，将进入到攻击序列Attack Sequence</p><p>在Find Point Near Enemy 任务中找到最近的敌人附近的位置，更新黑板的<code>Destination</code>值，<strong>获得AI角色该到达的<u>目的地</u></strong>(敌人附近)</p><p>Move To Enemy 任务<strong>跟随</strong>并攻击玩家，直至玩家死亡。</p><p><img src="/Website/assets/images/向敌人移动-90fc747deb7c4b3bad7135ac9c6327a8.png"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="题目五-4">题目五<a class="hash-link" href="#题目五-4" title="Direct link to heading">​</a></h3><p>基于行为树和AI感知组件实现随机巡逻任务</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="实现效果-28">实现效果<a class="hash-link" href="#实现效果-28" title="Direct link to heading">​</a></h4><p>(原项目只要地图中存在玩家，就会自动寻路找到玩家并攻击)</p><p>AI角色在没有感知到敌人时，进行随机巡逻，当视线内出现敌人后才开始进行攻击和追逐行为</p><p><img src="/Website/assets/images/随机巡逻-a4883d8ad39e29d8794486d079d13b84.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="解决办法-28">解决办法<a class="hash-link" href="#解决办法-28" title="Direct link to heading">​</a></h4><p>行为树中添加新的序列用于随机巡逻，添加两个<strong>装饰器</strong>(继承于BT装饰器蓝图基础)</p><ol><li><strong>RandomDes装饰器</strong>：用于找寻随机点，让AI角色进行随即巡逻</li></ol><p>​	根据Actor位置，连接<code>GetRandomReachablePointInRadius</code>节点，将返回值赋给Destination黑板键后完成执行</p><p><img src="/Website/assets/images/RandomDes-522a6dbd86a654bb429c826fb485233d.png"></p><ol start="2"><li><strong>FindPlayer装饰器</strong>：重写Perform Condition Check AI，将BotPawn中的<code>Is Find Player</code>赋值给黑板键<code>Is Find Player</code></li></ol><p><img src="/Website/assets/images/RandomDes-522a6dbd86a654bb429c826fb485233d.png"></p><p>将FindPlayer装饰器添加进攻击敌人的选择器中，如果视线内不存在敌人则不会进行攻击序列</p><p>为玩家角色蓝图添加<strong>AI感知刺激源组件</strong></p><p>给AI角色添加<strong>AI感知组件</strong>：视觉感知器官，对参数进行修改，归属检测全部选中</p><p><img src="/Website/assets/images/AI感知组件-39694a0be56f73919d184908d612989b.png"></p><p>定义<code>On Target Perception Updated</code>，如果感知到敌方并且为玩家，则设置Is Find Player为true</p><p><img src="/Website/assets/images/OnTargetPerceptionUpdated-9b06f29cf3754d5e20bb2646a69918d1.png"></p><p>实现AI通过视觉发现目标后去追随目标并进入攻击序列</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/Website/blog/tags/ue-4">UE4</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/Website/blog/tags/c">C++</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/Website/blog/tags/aurora-studios">Aurora Studios</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ShooterGame说明文档" href="/Website/blog/ShooterGame说明文档"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a href="https://www.docusaurus.io/zh-CN/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/Website/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/gai-zi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/Website/assets/js/runtime~main.82b6447d.js"></script>
<script src="/Website/assets/js/main.c450cb58.js"></script>
</body>
</html>